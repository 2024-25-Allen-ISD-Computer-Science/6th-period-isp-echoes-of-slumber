from turtle import Screen
import pygame
import sys

pygame.init()

# screen setup
info = pygame.display.Info()
screenWidth, screenHeight = info.current_w, info.current_h
screen = pygame.display.set_mode((screenWidth, screenHeight))
pygame.display.set_caption("Game")

# font setup
dialogueFont = pygame.font.Font("januaryNight/januaryNight.ttf", 36)

# temp color setup
WHITE = (255, 255, 255)
BLUE = (0, 0, 255)
BLACK = (0, 0, 0)

characterSpeed = 10

# character setup
mainSprite = pygame.image.load("mainSprite.png")
mainSprite = pygame.transform.scale(mainSprite, (250, 250))
mainRect = mainSprite.get_rect(topleft=(screenWidth/2 - 125, screenHeight/2 - 125))
shopkeeperSprite = pygame.image.load("shopkeeperSprite.png")
shopkeeperSprite = pygame.transform.scale(shopkeeperSprite, (190, 250))
shopkeeperRect = shopkeeperSprite.get_rect(topleft=(300, 200))
shopkeeperHeadshot = pygame.transform.scale(pygame.image.load("shopkeeperHeadshot.png"), (100, 100))

# dialogue setup
dialogue_text = "Would you like to purchase something?"
# holds what text is currently displayed
current_text = ""
# tracks # of characters to display
text_index = 0
# num of frames between each character's appearance
typing_speed = 3
typing_counter = 0

show_dialogue = False


# main loop
clock = pygame.time.Clock()
running = True
while running:
    screen.fill(WHITE)

    # drawing the character
    screen.blit(shopkeeperSprite, shopkeeperRect)
    screen.blit(mainSprite, mainRect)

    # user interaction
    # if user quits the game, stop clock
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        # if character is clicked, show dialogue
        if event.type == pygame.MOUSEBUTTONDOWN:
            if shopkeeperRect .collidepoint(event.pos):
                show_dialogue = True
                # reset displayed text
                current_text = ""
                text_index = 0
                typing_counter = 0
        # if right/left/up/down is clicked, character will move
        keys = pygame.key.get_pressed()
        if keys[pygame.K_LEFT] or keys[pygame.K_a]:
            mainRect.x -= characterSpeed
        if keys[pygame.K_RIGHT] or keys[pygame.K_d]:
            mainRect.x += characterSpeed
        if keys[pygame.K_UP] or keys[pygame.K_w]:
            mainRect.y -= characterSpeed
        if keys[pygame.K_DOWN] or keys[pygame.K_s]:
            mainRect.y += characterSpeed

    if show_dialogue:
            dialogue_box = pygame.Rect(screenWidth // 2 - 300, screenHeight * (4/5), 600, 100)  # box dimensions
            pygame.draw.rect(screen, (92, 95, 127), dialogue_box)
            pygame.draw.rect(screen, (202, 211, 228), dialogue_box.inflate(-10, -10))  # inner border
            screen.blit(shopkeeperHeadshot, (screenWidth // 2 - 300, screenHeight * (4/5)))

            # text animation
            if text_index < len(dialogue_text):
                 typing_counter += 1
                 if typing_counter % typing_speed == 0:
                      text_index += 1
                      current_text = dialogue_text[:text_index]
            
            text_surface = dialogueFont.render(current_text, True, (115, 98, 86))
            screen.blit(text_surface, (dialogue_box.x + 130, dialogue_box.y + 35))
    
    # update display
    pygame.display.flip()
    # set tick/framerate
    clock.tick(60)




